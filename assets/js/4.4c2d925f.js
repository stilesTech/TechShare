(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{427:function(s,t,p){s.exports=p.p+"assets/img/3162580750.d8a06617.png"},428:function(s,t,p){s.exports=p.p+"assets/img/1168153852.ae526cbe.png"},429:function(s,t,p){s.exports=p.p+"assets/img/4142944059.6e6a3e91.png"},430:function(s,t,p){s.exports=p.p+"assets/img/2421550577.3eb21575.png"},431:function(s,t,p){s.exports=p.p+"assets/img/2479369613.7316c45a.png"},432:function(s,t,p){s.exports=p.p+"assets/img/3222947489.c616dbaf.png"},433:function(s,t,p){s.exports=p.p+"assets/img/486419465.6237c42e.png"},434:function(s,t,p){s.exports=p.p+"assets/img/1355110498.edc71813.png"},435:function(s,t,p){s.exports=p.p+"assets/img/1250790354.9536585a.png"},436:function(s,t,p){s.exports=p.p+"assets/img/3540666399.162bad56.png"},437:function(s,t,p){s.exports=p.p+"assets/img/1938948609.c71de3f8.png"},438:function(s,t,p){s.exports=p.p+"assets/img/3796803176.26da37e4.png"},439:function(s,t,p){s.exports=p.p+"assets/img/3206538110.5ae119e8.png"},440:function(s,t,p){s.exports=p.p+"assets/img/3368305949.f0de3f20.png"},441:function(s,t,p){s.exports=p.p+"assets/img/3049339700.8546526e.png"},442:function(s,t,p){s.exports=p.p+"assets/img/1691913758.70a68ced.png"},443:function(s,t,p){s.exports=p.p+"assets/img/343398361.b0262f9e.png"},444:function(s,t,p){s.exports=p.p+"assets/img/1858383828.c3519040.png"},445:function(s,t,p){s.exports=p.p+"assets/img/886660607.0c9a2ffd.png"},573:function(s,t,p){"use strict";p.r(t);var n=p(10),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"sqlserver-alwayson搭建"}},[s._v("SqlServer AlwaysOn搭建")]),s._v(" "),t("p",[t("strong",[s._v("什么是Always On")])]),s._v(" "),t("p",[s._v("always on其实是指在sql server中实现高可用的解决方案之一，其实际是部署在Windows集群上的一个应用程序，是需要部署一个Windows故障转移集群（WSFC）。SQLServer集群则是部署Windows集群每个节点上的SQLServer应用。")]),s._v(" "),t("p",[s._v("官方文档 : AlwaysOn 可用性组概述 (SQL Server)")]),s._v(" "),t("p",[t("strong",[s._v("第一步.安装故障转移集群")])]),s._v(" "),t("p",[s._v("各个服务器节点都要安装故障转移集群")]),s._v(" "),t("p",[t("img",{attrs:{src:p(427),alt:"../uploads/2020/10/3162580750.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:p(428),alt:"../uploads/2020/10/1168153852.png"}})]),s._v(" "),t("p",[t("strong",[s._v("第二步：此处演示无域搭建故障转移集群的方式，每个节点的计算机不需要加入域，但需要添加DNS后缀，且每个节点的后缀必须要相同，如下图所示的操作")])]),s._v(" "),t("p",[s._v("DNS后缀和主机名可以随便取，DNS后缀 各个节点一致即可")]),s._v(" "),t("p",[t("img",{attrs:{src:p(429),alt:"../uploads/2020/10/4142944059.png"}})]),s._v(" "),t("p",[t("strong",[s._v("第三步：在每个节点上都添加一个用户，且用户名以及密码每个节点都一致,并添加率属于Administrators，此处为DCAdmin.")])]),s._v(" "),t("p",[t("img",{attrs:{src:p(430),alt:"../uploads/2020/10/2421550577.png"}})]),s._v(" "),t("p",[t("strong",[s._v("第四步：在每个节点的 hosts 文件中添加节点的计算机信息、群集信息、侦听器信息。")])]),s._v(" "),t("p",[s._v("hosts文件路径：C:\\Windows\\System32\\drivers\\etc")]),s._v(" "),t("p",[t("img",{attrs:{src:p(431),alt:"../uploads/2020/10/2479369613.png"}})]),s._v(" "),t("p",[t("strong",[s._v("第五步：调整sql server 服务账号，设置sql服务引擎和代理服务，登录账号调整为之前的添加的账号DCAdmin")])]),s._v(" "),t("p",[t("img",{attrs:{src:p(432),alt:"../uploads/2020/10/3222947489.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:p(433),alt:"../uploads/2020/10/486419465.png"}})]),s._v(" "),t("p",[t("strong",[s._v("第六步：使用sa账号登录sql server 添加前面添加的DCAdmin账号,并且赋予sysadmin权限")])]),s._v(" "),t("p",[t("img",{attrs:{src:p(434),alt:"../uploads/2020/10/1355110498.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:p(435),alt:"../uploads/2020/10/1250790354.png"}})]),s._v(" "),t("p",[t("strong",[s._v("第七步：设置内网ip4配置")])]),s._v(" "),t("p",[s._v("1.点击高级选择dns,如下图填入上文定义的dns")]),s._v(" "),t("p",[s._v("2选择WINS->NetBIOS设置，勾选禁用TCP/IP上的NetBIOS")]),s._v(" "),t("p",[t("img",{attrs:{src:p(436),alt:"../uploads/2020/10/3540666399.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:p(437),alt:"../uploads/2020/10/1938948609.png"}})]),s._v(" "),t("p",[t("strong",[s._v("第八步：配置注册表，把LocalAccountTokenFilterPolicy的值设置为1，配置方法：")])]),s._v(" "),t("p",[s._v("1.在【运行】对话框输入【regedit】，单击【确定】按钮")]),s._v(" "),t("p",[s._v("2.进入路径HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System")]),s._v(" "),t("p",[s._v("3.新建DWORD(32位)值(D) 名称为：LocalAccountTokenFilterPolicy 值为1，16进制。")]),s._v(" "),t("p",[t("img",{attrs:{src:p(438),alt:"../uploads/2020/10/3796803176.png"}})]),s._v(" "),t("p",[t("strong",[s._v("第九步：设置允许应用和功能通过防火墙，如下图配置")])]),s._v(" "),t("p",[t("img",{attrs:{src:p(439),alt:"../uploads/2020/10/3206538110.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:p(440),alt:"../uploads/2020/10/3368305949.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:p(441),alt:"../uploads/2020/10/3049339700.png"}})]),s._v(" "),t("p",[s._v("以下开始搭建故障转移集群")]),s._v(" "),t("p",[s._v("选择验证配置，服务机集群填入之前配置的多个节点的主机名，后选择添加即可,其它选项下一步。")]),s._v(" "),t("p",[s._v("生成摘要报告后选择创建集群")]),s._v(" "),t("p",[t("img",{attrs:{src:p(442),alt:"../uploads/2020/10/1691913758.png"}})]),s._v(" "),t("p",[s._v("在各个节点上开启sql server alwaysOn可用性组，设置后重启服务才生效。")]),s._v(" "),t("p",[t("img",{attrs:{src:p(443),alt:"../uploads/2020/10/343398361.png"}})]),s._v(" "),t("p",[s._v("重启后查看服务器属性，确认HADR是True")]),s._v(" "),t("p",[t("img",{attrs:{src:p(444),alt:"../uploads/2020/10/1858383828.png"}})]),s._v(" "),t("p",[s._v("接下来是配置可用性组，可用性组侦听器 ，参考： 从0开始搭建SQL Server AlwaysOn 第三篇 第八点开始即可，就不多此一举。")]),s._v(" "),t("p",[s._v("最后结果如下。")]),s._v(" "),t("p",[t("img",{attrs:{src:p(445),alt:"../uploads/2020/10/886660607.png"}})]),s._v(" "),t("p",[s._v("参考资料")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/dongxinhjj/article/details/80817333",target:"_blank",rel:"noopener noreferrer"}},[s._v("配置sqlServer 2016 无域AlwaysOn"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.cnblogs.com/lyhabc/p/4678330.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("从0开始搭建SQL Server AlwaysOn"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=r.exports}}]);